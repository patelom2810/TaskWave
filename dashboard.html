<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - TaskWave</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eefaff',
              100: '#d7f2ff',
              200: '#b8e8ff',
              300: '#88d9ff',
              400: '#53c0ff',
              500: '#2a9eff',
              600: '#137aff',
              700: '#1466ff',
              800: '#1852db',
              900: '#1a45ad',
              950: '#162b69',
            },
            secondary: {
              50: '#ecfdf5',
              100: '#d1fae5',
              200: '#a7f3d0',
              300: '#6ee7b7',
              400: '#34d399',
              500: '#10b981',
              600: '#059669',
              700: '#047857',
              800: '#065f46',
              900: '#064e3b',
              950: '#022c22',
            },
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  
  <!-- Custom CSS -->
  <style>
    .wave-bg {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%230099ff' fill-opacity='0.1' d='M0,224L48,208C96,192,192,160,288,154.7C384,149,480,171,576,181.3C672,192,768,192,864,170.7C960,149,1056,107,1152,101.3C1248,96,1344,128,1392,144L1440,160L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }
    
    .task-item:hover .task-actions {
      opacity: 1;
    }
    
    .task-actions {
      opacity: 0;
      transition: opacity 0.2s ease-in-out;
    }
    
    .priority-badge {
      position: relative;
      overflow: hidden;
    }
    
    .priority-badge.high::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,0,0,0.1) 0%, rgba(255,0,0,0) 70%);
      z-index: 0;
    }
    
    .shimmer {
      background: linear-gradient(90deg, 
        rgba(255,255,255,0) 0%, 
        rgba(255,255,255,0.2) 50%, 
        rgba(255,255,255,0) 100%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .task-complete-animation {
      animation: fadeGreen 1s ease-in-out;
    }
    
    @keyframes fadeGreen {
      0% { background-color: rgba(16, 185, 129, 0.1); }
      50% { background-color: rgba(16, 185, 129, 0.2); }
      100% { background-color: transparent; }
    }

    /* Profile dropdown animation */
    .profile-dropdown {
      transition: all 0.3s ease;
      transform-origin: top right;
      transform: scale(0.95);
      opacity: 0;
      visibility: hidden;
    }
    
    .profile-dropdown.active {
      transform: scale(1);
      opacity: 1;
      visibility: visible;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .mobile-menu-button {
        display: block;
      }
      
      .desktop-menu {
        display: none;
      }
      
      .mobile-menu {
        display: block;
      }
    }

    /* Profile image styles */
    .profile-image {
      transition: transform 0.3s ease;
    }
    
    .profile-image:hover {
      transform: scale(1.05);
    }
  </style>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-80 z-50 flex items-center justify-center">
    <div class="text-center">
      <div class="inline-block animate-pulse-slow">
        <div class="text-4xl font-bold">ðŸŒŠ <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-secondary-500">TaskWave</span></div>
      </div>
      <p class="mt-4 text-gray-600">Loading your dashboard...</p>
    </div>
  </div>

  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <div class="flex-shrink-0 flex items-center">
            <a href="dashboard.html" class="text-2xl font-bold">ðŸŒŠ <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-secondary-500">TaskWave</span></a>
          </div>
          <nav class="ml-6 hidden md:flex space-x-8 desktop-menu">
            <a href="dashboard.html" class="border-primary-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              Dashboard
            </a>
            <a href="tasks.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              Tasks
            </a>
            <a href="team.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              Team
            </a>
          </nav>
          <!-- Mobile menu button -->
          <button type="button" class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 mobile-menu-button">
            <span class="sr-only">Open main menu</span>
            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
        <div class="flex items-center">
          <div class="ml-4 flex items-center md:ml-6">
            <!-- Notification Bell -->
            <button class="p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 relative">
              <span class="sr-only">View notifications</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
              </svg>
              <span id="notificationBadge" class="hidden absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-400 ring-2 ring-white"></span>
            </button>

            <!-- Profile dropdown -->
            <div class="ml-3 relative group">
              <div class="flex items-center gap-2">
                <span id="userDisplayName" class="text-sm font-medium text-gray-700 hidden md:block">Loading...</span>
                <div id="profileButton" class="flex rounded-full bg-gray-100 text-sm focus:outline-none cursor-pointer profile-image">
                  <span id="profileImageContainer" class="inline-block h-8 w-8 rounded-full overflow-hidden bg-gray-200">
                    <svg id="defaultProfileImage" class="h-full w-full text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <img id="headerProfileImage" class="h-full w-full object-cover hidden" src="/placeholder.svg" alt="Profile picture">
                  </span>
                </div>
                <button id="logoutBtn" class="text-sm text-gray-500 hover:text-red-500 transition-colors hidden md:block">Logout</button>
              </div>
              
              <!-- Profile dropdown menu -->
              <div id="profileDropdown" class="profile-dropdown absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-20">
                <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    View Profile
                  </div>
                </a>
                <a href="profile.html#security" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    Security Settings
                  </div>
                </a>
                <a href="profile.html#preferences" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Preferences
                  </div>
                </a>
                <div class="border-t border-gray-100 my-1"></div>
                <button id="mobileLogoutBtn" class="w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Logout
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile menu, show/hide based on menu state -->
    <div class="md:hidden mobile-menu hidden" id="mobileMenu">
      <div class="pt-2 pb-3 space-y-1">
        <a href="dashboard.html" class="bg-primary-50 border-primary-500 text-primary-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
          Dashboard
        </a>
        <a href="tasks.html" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
          Tasks
        </a>
        <a href="team.html" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
          Team
        </a>
        <a href="profile.html" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">
          Profile
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Welcome Section -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8 wave-bg">
      <h1 id="welcomeMessage" class="text-2xl font-bold text-gray-900 mb-2">Welcome back!</h1>
      <p class="text-gray-600">Here's an overview of your tasks and collaborations.</p>
      <div class="mt-4 text-sm">
        <span id="currentDate" class="font-medium text-primary-700"></span>
      </div>
    </div>

    <!-- Dashboard Overview -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <!-- Tasks Overview -->
      <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">My Tasks</h2>
          <span id="totalTasksCount" class="bg-primary-100 text-primary-800 text-sm font-medium px-2.5 py-0.5 rounded-full">0</span>
        </div>
        <div class="space-y-2">
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Completed</span>
            <span id="completedTasksCount" class="text-sm font-medium text-gray-900">0</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div id="completedTasksProgress" class="bg-gradient-to-r from-primary-500 to-secondary-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
          </div>
        </div>
        <div class="mt-6 space-y-2">
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">High Priority</span>
            <span id="highPriorityCount" class="text-sm font-medium text-red-600">0</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Medium Priority</span>
            <span id="mediumPriorityCount" class="text-sm font-medium text-yellow-600">0</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Low Priority</span>
            <span id="lowPriorityCount" class="text-sm font-medium text-green-600">0</span>
          </div>
        </div>
        <div class="mt-4">
          <a href="tasks.html" class="text-sm text-primary-600 hover:text-primary-800 font-medium flex items-center">
            View all tasks
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Shared With Me -->
      <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">Shared With Me</h2>
          <span id="sharedWithMeCount" class="bg-secondary-100 text-secondary-800 text-sm font-medium px-2.5 py-0.5 rounded-full">0</span>
        </div>
        <div id="sharedWithMeList" class="space-y-3 max-h-[180px] overflow-y-auto">
          <!-- Will be populated dynamically -->
          <div class="text-sm text-gray-500 py-6 text-center">No shared tasks yet</div>
        </div>
        <div class="mt-4">
          <a href="team.html" class="text-sm text-secondary-600 hover:text-secondary-800 font-medium flex items-center">
            Manage collaborations
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Quick Add Task -->
      <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick Add Task</h2>
        <form id="quickAddTaskForm" class="space-y-4">
          <div>
            <label for="taskTitle" class="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
            <input type="text" id="taskTitle" name="taskTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="Enter task title">
          </div>
          <div>
            <label for="taskDescription" class="block text-sm font-medium text-gray-700 mb-1">Description (optional)</label>
            <textarea id="taskDescription" name="taskDescription" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="Brief description"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="taskPriority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
              <select id="taskPriority" name="taskPriority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
            <div>
              <label for="taskDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
              <input type="date" id="taskDueDate" name="taskDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500">
            </div>
          </div>
          <button type="submit" class="w-full bg-gradient-to-r from-primary-500 to-secondary-500 text-white py-2 rounded-md hover:opacity-90 transition-opacity flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
            Add Task
          </button>
        </form>
      </div>
    </div>
    
    <!-- Recent Tasks -->
    <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">Recent Tasks</h2>
        <div class="flex items-center">
          <div class="mr-4">
            <select id="taskFilter" class="text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-primary-500">
              <option value="all">All Tasks</option>
              <option value="completed">Completed</option>
              <option value="pending">Pending</option>
            </select>
          </div>
          <a href="tasks.html" class="text-sm text-primary-600 hover:text-primary-800 font-medium">View all</a>
        </div>
      </div>
      <div class="overflow-x-auto">
        <div class="overflow-hidden rounded-lg border border-gray-200">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Task</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody id="recentTasksList" class="bg-white divide-y divide-gray-200">
              <!-- Will be populated dynamically -->
              <tr>
                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">Loading tasks...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Task Completion Chart -->
    <div class="mt-8 bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Weekly Progress</h2>
      <div class="h-64">
        <canvas id="taskCompletionChart"></canvas>
      </div>
    </div>
  </main>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg transform transition-transform duration-300 translate-y-20 opacity-0 flex items-center">
    <div id="toastIcon" class="mr-2"></div>
    <div id="toastMessage"></div>
    <button id="toastClose" class="ml-4 text-gray-400 hover:text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Task Edit Modal -->
  <div id="taskEditModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 overflow-hidden">
      <div class="bg-gradient-to-r from-primary-500 to-secondary-500 px-4 py-3 text-white flex justify-between items-center">
        <h3 class="text-lg font-medium">Edit Task</h3>
        <button id="closeTaskModal" class="text-white hover:text-gray-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <form id="editTaskForm" class="p-6 space-y-4">
        <input type="hidden" id="editTaskId">
        <div>
          <label for="editTaskTitle" class="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
          <input type="text" id="editTaskTitle" name="editTaskTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500">
        </div>
        <div>
          <label for="editTaskDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
          <textarea id="editTaskDescription" name="editTaskDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"></textarea>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="editTaskPriority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
            <select id="editTaskPriority" name="editTaskPriority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div>
            <label for="editTaskDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
            <input type="date" id="editTaskDueDate" name="editTaskDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500">
          </div>
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="editTaskCompleted" name="editTaskCompleted" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
          <label for="editTaskCompleted" class="ml-2 block text-sm text-gray-900">Mark as completed</label>
        </div>
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" id="deleteTaskBtn" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
            Delete
          </button>
          <button type="submit" class="px-4 py-2 bg-gradient-to-r from-primary-500 to-secondary-500 text-white rounded-md hover:opacity-90 transition-opacity">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase Configuration -->
  <script src="js/firebase-config.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const auth = firebase.auth();
      const database = firebase.database();
      const storage = firebase.storage();
      
      // Elements
      const userDisplayName = document.getElementById('userDisplayName');
      const welcomeMessage = document.getElementById('welcomeMessage');
      const currentDate = document.getElementById('currentDate');
      const logoutBtn = document.getElementById('logoutBtn');
      const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
      const totalTasksCount = document.getElementById('totalTasksCount');
      const completedTasksCount = document.getElementById('completedTasksCount');
      const completedTasksProgress = document.getElementById('completedTasksProgress');
      const highPriorityCount = document.getElementById('highPriorityCount');
      const mediumPriorityCount = document.getElementById('mediumPriorityCount');
      const lowPriorityCount = document.getElementById('lowPriorityCount');
      const sharedWithMeCount = document.getElementById('sharedWithMeCount');
      const sharedWithMeList = document.getElementById('sharedWithMeList');
      const recentTasksList = document.getElementById('recentTasksList');
      const quickAddTaskForm = document.getElementById('quickAddTaskForm');
      const taskFilter = document.getElementById('taskFilter');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const toastIcon = document.getElementById('toastIcon');
      const toastClose = document.getElementById('toastClose');
      const taskEditModal = document.getElementById('taskEditModal');
      const closeTaskModal = document.getElementById('closeTaskModal');
      const editTaskForm = document.getElementById('editTaskForm');
      const editTaskId = document.getElementById('editTaskId');
      const editTaskTitle = document.getElementById('editTaskTitle');
      const editTaskDescription = document.getElementById('editTaskDescription');
      const editTaskPriority = document.getElementById('editTaskPriority');
      const editTaskDueDate = document.getElementById('editTaskDueDate');
      const editTaskCompleted = document.getElementById('editTaskCompleted');
      const deleteTaskBtn = document.getElementById('deleteTaskBtn');
      const profileButton = document.getElementById('profileButton');
      const profileDropdown = document.getElementById('profileDropdown');
      const mobileMenuButton = document.querySelector('.mobile-menu-button');
      const mobileMenu = document.getElementById('mobileMenu');
      const headerProfileImage = document.getElementById('headerProfileImage');
      const defaultProfileImage = document.getElementById('defaultProfileImage');
      
      // Set current date
      const now = new Date();
      currentDate.textContent = now.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      // Auth state change listener
      auth.onAuthStateChanged(function(user) {
        if (!user) {
          // Redirect to login if not signed in
          window.location.href = 'login.html';
          return;
        }
        
        // Load user data
        loadUserData(user.uid);
        
        // Load tasks
        loadTasks(user.uid);
        
        // Load shared tasks
        loadSharedTasks(user.uid);
        
        // Initialize chart
        initializeChart(user.uid);
        
        // Hide loading overlay
        setTimeout(() => {
          loadingOverlay.classList.add('opacity-0');
          setTimeout(() => {
            loadingOverlay.classList.add('hidden');
          }, 300);
        }, 1000);
      });
      
      // Logout
      logoutBtn.addEventListener('click', function() {
        auth.signOut().then(() => {
          window.location.href = 'login.html';
        }).catch(error => {
          console.error('Error signing out:', error);
          showToast('Error signing out: ' + error.message, 'error');
        });
      });
      
      // Mobile Logout
      mobileLogoutBtn.addEventListener('click', function() {
        auth.signOut().then(() => {
          window.location.href = 'login.html';
        }).catch(error => {
          console.error('Error signing out:', error);
          showToast('Error signing out: ' + error.message, 'error');
        });
      });
      
      // Toggle profile dropdown
      profileButton.addEventListener('click', function() {
        profileDropdown.classList.toggle('active');
      });
      
      // Close profile dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!profileButton.contains(e.target) && !profileDropdown.contains(e.target)) {
          profileDropdown.classList.remove('active');
        }
      });
      
      // Toggle mobile menu
      mobileMenuButton.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
      });
      
      // Quick Add Task
      quickAddTaskForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const user = auth.currentUser;
        if (!user) return;
        
        const taskTitle = document.getElementById('taskTitle').value.trim();
        const taskDescription = document.getElementById('taskDescription').value.trim();
        const taskPriority = document.getElementById('taskPriority').value;
        const taskDueDate = document.getElementById('taskDueDate').value;
        
        if (!taskTitle) {
          showToast('Please enter a task title', 'error');
          return;
        }
        
        const newTaskRef = database.ref('tasks/' + user.uid).push();
        newTaskRef.set({
          title: taskTitle,
          description: taskDescription || '',
          priority: taskPriority,
          dueDate: taskDueDate || '',
          completed: false,
          createdAt: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
          // Reset form
          quickAddTaskForm.reset();
          
          // Show success feedback
          showToast('Task added successfully!', 'success');
        }).catch(error => {
          console.error('Error adding task:', error);
          showToast('Error adding task: ' + error.message, 'error');
        });
      });
      
      // Task Filter
      taskFilter.addEventListener('change', function() {
        const user = auth.currentUser;
        if (!user) return;
        
        loadTasks(user.uid, this.value);
      });
      
      // Load user data
      function loadUserData(userId) {
        database.ref('users/' + userId).once('value')
          .then(snapshot => {
            const userData = snapshot.val();
            if (userData) {
              userDisplayName.textContent = userData.name;
              welcomeMessage.textContent = `Welcome back, ${userData.name}!`;
              
              // Load profile image if exists
              if (userData.profileImageUrl) {
                headerProfileImage.src = userData.profileImageUrl;
                headerProfileImage.classList.remove('hidden');
                defaultProfileImage.classList.add('hidden');
              }
            }
          })
          .catch(error => {
            console.error('Error loading user data:', error);
            showToast('Error loading user data', 'error');
          });
      }
      
      // Load tasks
      function loadTasks(userId, filter = 'all') {
        const tasksRef = database.ref('tasks/' + userId);
        
        tasksRef.orderByChild('createdAt').on('value', snapshot => {
          let tasks = [];
          let totalTasks = 0;
          let completedTasks = 0;
          let highPriority = 0;
          let mediumPriority = 0;
          let lowPriority = 0;
          
          // Clear existing content
          recentTasksList.innerHTML = '';
          
          if (snapshot.exists()) {
            snapshot.forEach(childSnapshot => {
              const taskId = childSnapshot.key;
              const taskData = childSnapshot.val();
              
              totalTasks++;
              
              if (taskData.completed) {
                completedTasks++;
              }
              
              // Count by priority
              switch(taskData.priority) {
                case 'high':
                  highPriority++;
                  break;
                case 'medium':
                  mediumPriority++;
                  break;
                case 'low':
                  lowPriority++;
                  break;
              }
              
              // Apply filter
              if (filter === 'all' || 
                 (filter === 'completed' && taskData.completed) || 
                 (filter === 'pending' && !taskData.completed)) {
                tasks.push({
                  id: taskId,
                  ...taskData
                });
              }
            });
            
            // Sort by newest first
            tasks.sort((a, b) => b.createdAt - a.createdAt);
            
            // Limit to 5 for display
            const displayTasks = tasks.slice(0, 5);
            
            // Update tasks table
            if (displayTasks.length > 0) {
              displayTasks.forEach(task => {
                const row = createTaskRow(task);
                recentTasksList.appendChild(row);
              });
            } else {
              recentTasksList.innerHTML = `
                <tr>
                  <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No tasks found</td>
                </tr>
              `;
            }
            
            // Update task counters
            totalTasksCount.textContent = totalTasks;
            completedTasksCount.textContent = `${completedTasks} / ${totalTasks}`;
            highPriorityCount.textContent = highPriority;
            mediumPriorityCount.textContent = mediumPriority;
            lowPriorityCount.textContent = lowPriority;
            
            // Update progress bar
            const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks * 100) : 0;
            completedTasksProgress.style.width = `${progressPercentage}%`;
          } else {
            // No tasks
            recentTasksList.innerHTML = `
              <tr>
                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No tasks found</td>
              </tr>
            `;
            
            totalTasksCount.textContent = '0';
            completedTasksCount.textContent = '0 / 0';
            highPriorityCount.textContent = '0';
            mediumPriorityCount.textContent = '0';
            lowPriorityCount.textContent = '0';
            completedTasksProgress.style.width = '0%';
          }
        });
      }
      
      // Load shared tasks
      function loadSharedTasks(userId) {
        const sharedTasksRef = database.ref('sharedTasks/' + userId);
        
        sharedTasksRef.on('value', snapshot => {
          // Clear existing content
          sharedWithMeList.innerHTML = '';
          
          if (snapshot.exists()) {
            let count = 0;
            const sharedItems = [];
            
            snapshot.forEach(childSnapshot => {
              count++;
              const sharedData = childSnapshot.val();
              sharedItems.push({
                id: childSnapshot.key,
                ...sharedData
              });
            });
            
            // Update counter
            sharedWithMeCount.textContent = count;
            
            // Sort by newest first
            sharedItems.sort((a, b) => b.sharedAt - a.sharedAt);
            
            // Limit display to 3 items
            const displayItems = sharedItems.slice(0, 3);
            
            // Display shared items
            if (displayItems.length > 0) {
              displayItems.forEach(item => {
                const sharedItem = document.createElement('div');
                sharedItem.className = 'flex items-center p-2 rounded-md bg-gray-50 hover:bg-gray-100 transition-colors';
                
                const priorityClass = item.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                     item.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 
                                     'bg-green-100 text-green-800';
                
                sharedItem.innerHTML = `
                  <div class="flex-shrink-0 mr-3">
                    <div class="w-8 h-8 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center">
                      ${item.fromName ? item.fromName.charAt(0).toUpperCase() : '?'}
                    </div>
                  </div>
                  <div class="flex-grow">
                    <div class="text-sm font-medium">${item.title || 'Untitled Task'}</div>
                    <div class="text-xs text-gray-500">From: ${item.fromName || 'Unknown user'}</div>
                  </div>
                  <div class="flex-shrink-0 ml-2">
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${priorityClass}">
                      ${item.priority || 'medium'}
                    </span>
                  </div>
                `;
                
                sharedWithMeList.appendChild(sharedItem);
              });
              
              // Add "more" indicator if needed
              if (count > 3) {
                const moreIndicator = document.createElement('div');
                moreIndicator.className = 'text-center text-xs text-gray-500 mt-2';
                moreIndicator.textContent = `+ ${count - 3} more`;
                sharedWithMeList.appendChild(moreIndicator);
              }
            } else {
              sharedWithMeList.innerHTML = '<div class="text-sm text-gray-500 py-6 text-center">No shared tasks yet</div>';
            }
          } else {
            // No shared tasks
            sharedWithMeCount.textContent = '0';
            sharedWithMeList.innerHTML = '<div class="text-sm text-gray-500 py-6 text-center">No shared tasks yet</div>';
          }
        });
      }
      
      // Create task row for table
      function createTaskRow(task) {
        const row = document.createElement('tr');
        row.className = 'task-item hover:bg-gray-50 transition-colors';
        
        if (task.completed) {
          row.classList.add('bg-gray-50');
        }
        
        // Format date
        let formattedDate = 'No due date';
        if (task.dueDate) {
          const date = new Date(task.dueDate);
          formattedDate = date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          });
        }
        
        // Priority badge class
        let priorityClass = '';
        let priorityText = task.priority || 'medium';
        
        switch (priorityText.toLowerCase()) {
          case 'high':
            priorityClass = 'bg-red-100 text-red-800';
            break;
          case 'medium':
            priorityClass = 'bg-yellow-100 text-yellow-800';
            break;
          case 'low':
            priorityClass = 'bg-green-100 text-green-800';
            break;
          default:
            priorityClass = 'bg-gray-100 text-gray-800';
        }
        
        // Status badge class
        const statusClass = task.completed 
          ? 'bg-green-100 text-green-800' 
          : 'bg-blue-100 text-blue-800';
        
        const statusText = task.completed ? 'Completed' : 'In Progress';
        
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-4 w-4 mr-3">
                <input type="checkbox" class="task-checkbox h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" 
                  data-task-id="${task.id}" ${task.completed ? 'checked' : ''}>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-900 ${task.completed ? 'line-through text-gray-500' : ''}">
                  ${task.title}
                </div>
                ${task.description ? `<div class="text-xs text-gray-500 mt-1 max-w-xs truncate">${task.description}</div>` : ''}
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="priority-badge ${task.priority === 'high' ? 'high' : ''} inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityClass}">
              ${priorityText.charAt(0).toUpperCase() + priorityText.slice(1)}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}">
              ${statusText}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${formattedDate}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <div class="flex justify-end items-center space-x-2 task-actions">
              <button class="edit-task-btn text-primary-600 hover:text-primary-900" data-task-id="${task.id}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
              </button>
              <button class="delete-task-btn text-red-600 hover:text-red-900" data-task-id="${task.id}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </div>
          </td>
        `;
        
        // Add event listeners
        const checkbox = row.querySelector('.task-checkbox');
        checkbox.addEventListener('change', function() {
          toggleTaskCompletion(this.dataset.taskId, this.checked);
          
          // Add animation class
          if (this.checked) {
            row.classList.add('task-complete-animation');
            setTimeout(() => {
              row.classList.remove('task-complete-animation');
            }, 1000);
          }
        });
        
        const editBtn = row.querySelector('.edit-task-btn');
        editBtn.addEventListener('click', function() {
          openEditTaskModal(this.dataset.taskId);
        });
        
        const deleteBtn = row.querySelector('.delete-task-btn');
        deleteBtn.addEventListener('click', function() {
          if (confirm('Are you sure you want to delete this task?')) {
            deleteTask(this.dataset.taskId);
          }
        });
        
        return row;
      }
      
      // Toggle task completion
      function toggleTaskCompletion(taskId, completed) {
        const user = auth.currentUser;
        if (!user) return;
        
        database.ref(`tasks/${user.uid}/${taskId}`).update({
          completed: completed,
          completedAt: completed ? firebase.database.ServerValue.TIMESTAMP : null
        }).then(() => {
          showToast(completed ? 'Task completed!' : 'Task marked as incomplete', 'success');
        }).catch(error => {
          console.error('Error updating task:', error);
          showToast('Error updating task', 'error');
        });
      }
      
      // Delete task
      function deleteTask(taskId) {
        const user = auth.currentUser;
        if (!user) return;
        
        database.ref(`tasks/${user.uid}/${taskId}`).remove()
          .then(() => {
            showToast('Task deleted successfully', 'success');
            
            // Close modal if open
            if (!taskEditModal.classList.contains('hidden') && editTaskId.value === taskId) {
              taskEditModal.classList.add('hidden');
            }
          })
          .catch(error => {
            console.error('Error deleting task:', error);
            showToast('Error deleting task', 'error');
          });
      }
      
      // Open edit task modal
      function openEditTaskModal(taskId) {
        const user = auth.currentUser;
        if (!user) return;
        
        database.ref(`tasks/${user.uid}/${taskId}`).once('value')
          .then(snapshot => {
            const taskData = snapshot.val();
            if (taskData) {
              editTaskId.value = taskId;
              editTaskTitle.value = taskData.title || '';
              editTaskDescription.value = taskData.description || '';
              editTaskPriority.value = taskData.priority || 'medium';
              editTaskDueDate.value = taskData.dueDate || '';
              editTaskCompleted.checked = taskData.completed || false;
              
              taskEditModal.classList.remove('hidden');
            }
          })
          .catch(error => {
            console.error('Error loading task data:', error);
            showToast('Error loading task data', 'error');
          });
      }
      
      // Close task modal
      closeTaskModal.addEventListener('click', function() {
        taskEditModal.classList.add('hidden');
      });
      
      // Click outside to close
      taskEditModal.addEventListener('click', function(e) {
        if (e.target === taskEditModal) {
          taskEditModal.classList.add('hidden');
        }
      });
      
      // Edit task form submit
      editTaskForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const user = auth.currentUser;
        if (!user) return;
        
        const taskId = editTaskId.value;
        const title = editTaskTitle.value.trim();
        const description = editTaskDescription.value.trim();
        const priority = editTaskPriority.value;
        const dueDate = editTaskDueDate.value;
        const completed = editTaskCompleted.checked;
        
        if (!title) {
          showToast('Please enter a task title', 'error');
          return;
        }
        
        const updates = {
          title: title,
          description: description,
          priority: priority,
          dueDate: dueDate,
          completed: completed,
          updatedAt: firebase.database.ServerValue.TIMESTAMP
        };
        
        // Add completedAt timestamp if task is completed and wasn't before
        if (completed) {
          database.ref(`tasks/${user.uid}/${taskId}`).once('value')
            .then(snapshot => {
              const taskData = snapshot.val();
              if (taskData && !taskData.completed) {
                updates.completedAt = firebase.database.ServerValue.TIMESTAMP;
              }
              
              return database.ref(`tasks/${user.uid}/${taskId}`).update(updates);
            })
            .then(() => {
              taskEditModal.classList.add('hidden');
              showToast('Task updated successfully', 'success');
            })
            .catch(error => {
              console.error('Error updating task:', error);
              showToast('Error updating task: ' + error.message, 'error');
            });
        } else {
          database.ref(`tasks/${user.uid}/${taskId}`).update(updates)
            .then(() => {
              taskEditModal.classList.add('hidden');
              showToast('Task updated successfully', 'success');
            })
            .catch(error => {
              console.error('Error updating task:', error);
              showToast('Error updating task: ' + error.message, 'error');
            });
        }
      });
      
      // Delete task button in modal
      deleteTaskBtn.addEventListener('click', function() {
        const taskId = editTaskId.value;
        if (confirm('Are you sure you want to delete this task?')) {
          deleteTask(taskId);
        }
      });
      
      // Initialize chart
      function initializeChart(userId) {
        const ctx = document.getElementById('taskCompletionChart').getContext('2d');
        
        // Get dates for the last 7 days
        const dates = [];
        const today = new Date();
        
        for (let i = 6; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(today.getDate() - i);
          dates.push(date);
        }
        
        // Format dates for display
        const formattedDates = dates.map(date => 
          date.toLocaleDateString('en-US', { weekday: 'short' })
        );
        
        // Initialize with empty data
        const completedData = [0, 0, 0, 0, 0, 0, 0];
        const addedData = [0, 0, 0, 0, 0, 0, 0];
        
        // Create chart
        const chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: formattedDates,
            datasets: [
              {
                label: 'Tasks Completed',
                data: completedData,
                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                borderColor: 'rgba(16, 185, 129, 1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true
              },
              {
                label: 'Tasks Added',
                data: addedData,
                backgroundColor: 'rgba(42, 158, 255, 0.2)',
                borderColor: 'rgba(42, 158, 255, 1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top',
              },
              tooltip: {
                mode: 'index',
                intersect: false,
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            }
          }
        });
        
        // Load task data for chart
        database.ref(`tasks/${userId}`).once('value')
          .then(snapshot => {
            if (snapshot.exists()) {
              // Reset data arrays
              for (let i = 0; i < 7; i++) {
                completedData[i] = 0;
                addedData[i] = 0;
              }
              
              // Process tasks
              snapshot.forEach(childSnapshot => {
                const task = childSnapshot.val();
                
                // Check when task was created
                if (task.createdAt) {
                  const createdDate = new Date(task.createdAt);
                  
                  // Check if created in the last 7 days
                  for (let i = 0; i < 7; i++) {
                    if (isSameDay(createdDate, dates[i])) {
                      addedData[i]++;
                      break;
                    }
                  }
                }
                
                // Check when task was completed
                if (task.completed && task.completedAt) {
                  const completedDate = new Date(task.completedAt);
                  
                  // Check if completed in the last 7 days
                  for (let i = 0; i < 7; i++) {
                    if (isSameDay(completedDate, dates[i])) {
                      completedData[i]++;
                      break;
                    }
                  }
                }
              });
              
              // Update chart
              chart.data.datasets[0].data = completedData;
              chart.data.datasets[1].data = addedData;
              chart.update();
            }
          })
          .catch(error => {
            console.error('Error loading chart data:', error);
          });
      }
      
      // Helper function to check if two dates are the same day
      function isSameDay(date1, date2) {
        return date1.getDate() === date2.getDate() &&
               date1.getMonth() === date2.getMonth() &&
               date1.getFullYear() === date2.getFullYear();
      }
      
      // Show toast notification
      function showToast(message, type = 'info') {
        toastMessage.textContent = message;
        
        toast.classList.remove('bg-green-500', 'bg-red-500', 'bg-blue-500');
        
        if (type === 'success') {
          toast.classList.add('bg-green-500');
          toastIcon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
          `;
        } else if (type === 'error') {
          toast.classList.add('bg-red-500');
          toastIcon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
          `;
        } else {
          toast.classList.add('bg-blue-500');
          toastIcon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg>
          `;
        }
        
        toast.classList.add('text-white');
        toast.classList.remove('translate-y-20', 'opacity-0');
        
        // Auto hide after 3 seconds
        setTimeout(() => {
          toast.classList.add('translate-y-20', 'opacity-0');
        }, 3000);
      }
      
      // Close toast
      toastClose.addEventListener('click', function() {
        toast.classList.add('translate-y-20', 'opacity-0');
      });
    });
  </script>
</body>
</html>
